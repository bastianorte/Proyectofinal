
<% if user_signed_in? %>
  <%= render'families/banners' %>
  <div class="container pt-4">

    <p id="notice"><%= notice %></p>


    <% @families.each do |family| %>
      <div class="row">
        <div class="col">
          <h2><%= family.name %></h2><br>
          <img src="<%= family.photo %>"> </div>
        <div class="col">  <%= link_to 'Show', family %> </div>
        <div class="col">  <%= link_to 'Edit', edit_family_path(family) %> </div>
        <div class="col">  <%= link_to 'Destroy', family, method: :delete, data: { confirm: 'Are you sure?' } %> </div>
      </div>
    <% end %>

    <div class="row">
      <%= link_to 'New Family', new_family_path %>
    </div>

    <div class="row">
      <h1>Usuarios</h1>
    </div>

      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-2">Foto</div>
            <div class="col-3">Caracteristicas</div>
            <div class="col-4">Calorias</div>
            <div class="col">IMC</div>
          </div>
        </div>
      </div>

        <% @users.each do |user| %>
        <div class="card">
          <div class="card-body">
            <div class="row">
                <div class="col-2">
                  <img src="<%= user.photo.thumb %>" style="width:150px;">
                </div>
                <div class="col-3">
                    <h4><%= user.name %></h4> <br>
                    <%= user.age %> a√±os<br>
                    <%= user.weight %> kilogramos<br>
                    <%= user.height %> centimetros<br>
                    <%= user.physical_activity_level %><br>
                    <%= user.daily_carbohydrates %> grs<br>
                    <%= user.email %><br>
                    <%= user.family.name %><br>
                    <%= link_to 'Edit', edit_user_path(user) %><br>

                </div>
                <div class="col-4">

                      <canvas data-calorie= "<%= user %>"  id="pie-chart<%= user.id %>"></canvas>
                      <script>
                      new Chart(document.getElementById("pie-chart<%= user.id %>"), {
                        type: 'pie',
                        data: {
                          labels: ["Calorias necesarias", "Calorias consumidas"],
                          position: 'top',
                          datasets: [{
                            backgroundColor: ["#0079c8", "#00335b"],
                            data: [<%= user.daily_calories %>,<%= user.foods.sum(:calorie) %>]
                          }]
                        },
                        options: {
                          legend: {
                            display: true,
                            position: 'top',
                                  }}
                      });
                      </script>
                </div>
            <div class="col">
              <h3>IMC = <%= user.imc %></h3>
                <% if user.imc != nil %>
                  <% if user.imc < 18 %>
                    <p> Bajo peso </p>
                    <div class="progress" style="height: 5px;">
                      <div class="progress-bar" data-aos-offset="20" data-aos-duration="2000" role="progressbar" style="width: 90%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="40"></div>
                    </div>

                </div>
                <% elsif user.imc > 18 && user.imc < 25 %>
                  <p> Normal </p>
                    <div class="progress" style="height: 5px;">
                      <div class="progress-bar" data-aos-offset="20" data-aos-duration="2000" role="progressbar" style="width: 90%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="40"></div>
                    </div>

              </div>
              <% elsif user.imc > 26 && user.imc < 30 %>
                <p>Sobrepeso</p>
                  <div class="progress" style="height: 5px;">
                    <div class="progress-bar" data-aos-offset="20" data-aos-duration="2000" role="progressbar" style="width: 90%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="40"></div>
                  </div>

            </div>
            <% else %>
              <p>Obesidad</p>
                <div class="progress">
                  <div class="progress-bar" role="progressbar" style="width: 25%" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                  <div class="progress-bar bg-success" role="progressbar" style="width: 25%" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                  <div class="progress-bar bg-info" role="progressbar" style="width: 25%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>
                  <div class="progress-bar bg-danger" role="progressbar" style="width: 25%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"></div>

                </div>
          <% end %>
          <% end %>
          </div>


            </div>
              <div class="row">
                      <div class="col">
                      <%= link_to 'Nuevo alimento', new_family_path,  { 'data-toggle' =>  "modal", 'data-target' => '#modal-window', class: 'btn btn-outline-primary btn-sm'}  %>
                            <div id="modal-window" class="modal" role="dialog" aria-labelledby="myModalLabel">
                              <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                                <div class="modal-header">
                                                  <h5 class="modal-title">Modal title</h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                  </div>
                                                    <div class="modal-body">
                                                          <%= form_for(@event) do |f| %>
                                                                <div class="field">
                                                                  <%= f.label :food_id %>
                                                                  <%= f.collection_select(:food_id, Food.all, :id, :name) %>
                                                                </div>
                                                            <%= f.hidden_field :user_id, :value => user.id %>
                                                    </div>
                                                <div class="modal-footer">
                                                    <%= f.submit %>
                                                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                    <% end %>
                                                </div>
                                </div>
                            </div>
                        </div>
                      <br><%= link_to 'Edit', edit_user_path(user), class: "btn btn-outline-primary btn-sm" %>
                </div>
          </div>
          </div>
        <% end %>

    </div>
      <div class="row">
        <div class="col">
          <%= link_to 'Nuevo Usuario', new_user_path, class: "btn btn-outline-primary btn-sm" %>
        </div>
      </div>
  <% else %>
      <%= render'families/otro' %>
  <% end %>
